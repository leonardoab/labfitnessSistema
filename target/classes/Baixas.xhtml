<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:opt="http://primefaces.prime.com.tr/optimus"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="#{perfilAcessoController.perfilTemplete}">
	<ui:define name="corpo">
		<script type="text/javascript"
			src="recursos/js/jquery.validate.min.js" charset="charset=UTF-8" />
		<script type="text/javascript" src="recursos/js/validaLogin.js"
			charset="charset=UTF-8" />

		<p:growl autoUpdate="true" />
		<div class="titulo">
			<legend>Baixas</legend>
		</div>

		<div class="form-horizontal">

			<h:form class="formularioCentro" id="baixasForm"
				enctype="multipart/form-data">


				<p:dataTable var="registro" widgetVar="gridNotas"
					value="#{baixasController.listaNotaFiscal}" id="gridNotas"
					emptyMessage="Não há notas fiscais cadastradas."
					filteredValue="#{baixasController.listaNotaFiscalFiltrada}"
					scrollable="true" scrollHeight="450">
					<f:facet name="header">


						<f:facet name="header">
							<h:commandLink style="MARGIN-LEFT: 81%;padding-right: 15px;">
								<p:graphicImage value="resources/img/excel.png" />
								<p:dataExporter type="xls" target="gridNotas"
									fileName="Relatorio_contabilidade"
									postProcessor="#{baixasController.postProcessXLS}" />
							</h:commandLink>

						</f:facet>


					</f:facet>

					<p:column headerText="Tipo Nota Fiscal"
						sortBy="#{registro.tipoRegistro}"
						filterBy="#{registro.tipoRegistro}" filterStyle="width: 53px;"
						style="padding: 4px 4px;text-align: center;width: 61px;">
						<f:facet name="header">
							<h:outputText value="Tipo" />
						</f:facet>
						<h:outputText value="#{registro.tipoRegistro}" />
					</p:column>

					<p:column headerText="Nr.Nota" sortBy="#{registro.numero}"
						filterBy="#{registro.numero}" filterStyle="width: 57px;"
						style="padding: 4px 4px;text-align: center;width: 65px;">
						<f:facet name="header">
							<h:outputText value="Nr.Nota" />
						</f:facet>
						<h:outputText value="#{registro.numero}" />
					</p:column>

					<p:column headerText="Valor Nota" filterBy="#{registro.valor}"
						filterStyle="width: 75px;" sortBy="#{registro.valor}"
						style="padding: 4px 4px;text-align: center;width: 83px;">
						<f:facet name="header">
							<h:outputText value="Valor Nota" />
						</f:facet>
						<h:outputText value="#{registro.valor}">
							<f:convertNumber pattern="#0.00" />
						</h:outputText>
					</p:column>

					<p:column headerText="C.Forn.GPS" filterStyle="width: 80px;"
						filterBy="#{registro.fornecedor.cdPrestador}"
						filterMatchMode="contains"
						sortBy="#{registro.fornecedor.cdPrestador}"
						style="padding: 4px 4px;text-align: center;width: 88px;">
						<f:facet name="header">
							<h:outputText value="C.Forn.GPS" />
						</f:facet>
						<h:outputText value="#{registro.fornecedor.cdPrestador}">
							<f:convertNumber pattern="00000000" />
						</h:outputText>
					</p:column>


					<p:column headerText="Nome Fornecedor"
						sortBy="#{registro.fornecedor.nome}"
						filterBy="#{registro.fornecedor.nome}" filterMatchMode="contains"
						filterStyle="width: 224px;" style="padding: 4px 4px;">
						<f:facet name="header">
							<h:outputText value="Nome Fornecedor" />
						</f:facet>
						<h:outputText value="#{registro.fornecedor.nome}" />
					</p:column>

					<p:column headerText="Guia Autorização"
						sortBy="#{registro.guiaAutorizacao.numeroGuiaCompleto}"
						filterBy="#{registro.guiaAutorizacao.numeroGuiaCompleto}"
						filterStyle="width: 76px;"
						style="padding: 4px 4px;width: 85px;text-align: center;">
						<f:facet name="header">
							<h:outputText value="Guia.Aut." />
						</f:facet>
						<h:outputText
							value="#{registro.guiaAutorizacao.numeroGuiaCompleto}" />
					</p:column>

					<p:column headerText="Carteira Benef."
						sortBy="#{registro.beneficiario.cdCarteiraInteiraString}"
						style="padding: 4px 4px;width: 145px;text-align: center;"
						filterBy="#{registro.beneficiario.cdCarteiraInteiraString} "
						filterStyle="width: 136px;">
						<f:facet name="header">
							<h:outputText value="Carteira Benef." />
						</f:facet>

						<h:outputText
							value="#{registro.beneficiario.cdCarteiraInteiraString}">

						</h:outputText>
					</p:column>
					<p:column headerText="Nm.Benef."
						sortBy="#{registro.beneficiario.nome}" style="padding: 4px 4px;"
						filterBy="#{registro.beneficiario.nome}"
						filterStyle="width: 226px;">
						<f:facet name="header">
							<h:outputText value="Nome Beneficiário" />
						</f:facet>
						<h:outputText value="#{registro.beneficiario.nome}" />


					</p:column>

					<p:column style="padding: 4px 4px;width: 90px;text-align: center;"
						filterBy="#{registro.status}" filterMatchMode="exact"
						filterStyle="display:none;">

						<f:facet name="header">
							<h:outputText value="Situação Nota" />

							<p:selectOneMenu value="#{baixasController.situacaoFiltro}">

								<f:selectItem itemLabel="Aberta" itemValue="Aberta"
									noSelectionOption="true" />
								<f:selectItem itemLabel="Baixadas" itemValue="Baixadas" />
								<f:selectItem itemLabel="Todas" itemValue="Todas" />


								<p:ajax event="change"
									listener="#{baixasController.BuscarPorStatus()}"
									update="gridNotas" />

							</p:selectOneMenu>
						</f:facet>
						<h:outputText value="#{registro.status}" />
					</p:column>

					<p:column headerText="Comp.Baixa"
						sortBy="#{registro.competenciaBaixa}" filterStyle="width: 84px;"
						filterBy="#{registro.competenciaBaixa}" filterMatchMode="contains"
						style="padding: 4px 4px;width: 93px;text-align: center;">

						<h:outputText value="#{registro.competenciaBaixa}" />
					</p:column>
					
					
					
					<p:column style="padding: 4px 4px;width: 20px;text-align: center;">
						<p:commandLink update=":form" oncomplete="PF('dlg2').show()"
							styleClass="ui-icon ui-icon-wrench" title="Editar Nota"
							action="#{baixasController.carregarNota()}">
							<f:setPropertyActionListener value="#{registro}"
								target="#{baixasController.notaFiscalSelecionada}" />
						</p:commandLink>
					</p:column>
					




				</p:dataTable>
			</h:form>


			<!-- Tela Dialog -->
			<p:dialog header="Nota Fiscal" widgetVar="dlg2" modal="true"
				height="350" id="dlg_editar" closeOnEscape="true" width="750">
				<h:panelGroup id="pnl_Dialogo">
					<h:form id="form" style="font-size:12px;" class="formularioCentro">

						<p:growl id="messages" autoUpdate="true" closable="true" />
						
						<div class="row">

							<div class="col-md-4" style="width: 23%;">
								<p:outputLabel value="Tipo Nota" />
								<p:inputText size="22" id="tipoNota" 
									value="#{baixasController.notaFiscal.tipoRegistro}"
									disabled="true" />
							</div>
							<div class="col-md-4" style="width: 23%;">
								<p:outputLabel value="Número Nota Fiscal:" />
								<p:inputText size="22" id="numeroNotaFiscal" 
									value="#{baixasController.notaFiscal.numero}" disabled="true" />
							</div>
							<div class="col-md-4" style="width: 23%;">
								<p:outputLabel value="Valor Nota Fiscal:" />
								<pe:inputNumber id="valorNotaFiscal"
							    disabled="true"
								value="#{baixasController.notaFiscal.valor}" 
								symbolPosition="s" decimalSeparator="," thousandSeparator=".">
								
							</pe:inputNumber>
							</div>
							<div class="col-md-4" style="width: 23%;">
								<p:outputLabel value="Qtd Itens Nota Fiscal:" />
								<p:inputText size="22" id="quantidadeItens"
									disabled="true"
									value="#{baixasController.notaFiscal.qtdItens}" />
							</div>
						</div>


						<div class="row">
							<div class="col-sm-4" style="width: 23%;">
								<p:outputLabel value="Cód. Forn.:" />
								<p:inputMask mask="?99999999" id="codigoFornecedor"
									disabled="true"
									value="#{baixasController.notaFiscal.fornecedor.cdPrestador}"
									size="22" style="font-weight: 100;" >

								</p:inputMask>
							</div>
							<div class="col-sm-4" style="width: 23%;">
								<p:outputLabel value="CNPJ Forn.:" />
								<p:inputText id="cnpjFornecedor" disabled="true"
									value="#{baixasController.notaFiscal.fornecedor.cnpj}"
									size="22" style="font-weight: 100;">

								</p:inputText>
							</div>
							<div class="col-sm-6" style="width: 46%;">
								<p:outputLabel value="Nome Forn.:" />
								<p:inputText id="nomeFornecedor"
									value="#{baixasController.notaFiscal.fornecedor.nome}"
									style="font-weight: 100;" size="52" disabled="true" />

							</div>

						</div>
						<div class="row">

							<div class="col-md-4" style="width: 6%;">
								<p:outputLabel value="Unid:" />
								<p:inputMask mask="?9999" size="1" maxlength="10"
									id="unidadeCarteiraBeneficiario" 
									value="#{baixasController.notaFiscal.beneficiario.unidade}"
									disabled="true">

								</p:inputMask>
							</div>
							<div class="col-md-4" style="width: 17%;">
								<p:outputLabel value="Nr Carteira:" />
								<p:inputMask mask="?9999999999999" size="14" maxlength="100"
									id="carteiraBeneficiario" 
									value="#{baixasController.notaFiscal.beneficiario.cdCarteiraInteira}"
									disabled="true">

								</p:inputMask>
							</div>
							<div class="col-md-6" style="width: 46%;">
								<p:outputLabel value="Nome Beneficiário:" />
								<p:inputText id="nomeBeneficiario"
									value="#{baixasController.notaFiscal.beneficiario.nome}"
									size="52" disabled="true" />
							</div>
							<div class="col-md-4" style="width: 11%;">
								<p:outputLabel value="Ano:" />
								<p:inputText id="anoGuiaAutorizacao"
									disabled="true"
									value="#{baixasController.notaFiscal.guiaAutorizacao.ano}"
									style="width:60px" 
									/>
									
							</div>
							<div class="col-md-4" style="width: 12%;">
								<p:outputLabel value="Nr Guia:" />
								<p:inputText id="guiaAutorizacao"
									disabled="true"
									value="#{baixasController.notaFiscal.guiaAutorizacao.numero}"
									style="width:77px" 
									/>
									
							</div>

						</div>

						<div class="row">


							

							<div class="col-md-4" style="width: 22%;">
								<p:outputLabel value="Situação:" />
								<p:selectOneMenu id="situacaoNota"
									value="#{baixasController.notaFiscal.status}" required="true"
									requiredMessage="Status da Nota obrigatória"
									style="width:120px">
									<f:selectItem itemLabel="Aberta" itemValue="Aberta" />
									<f:selectItem itemLabel="Ajuste Contabil"
										itemValue="Ajuste Contabil" />
									<f:selectItem itemLabel="Baixa Ajuste" itemValue="Baixa Ajuste" />
									<f:selectItem itemLabel="Baixa Completa"
										itemValue="Baixa Completa" />
									<f:selectItem itemLabel="Baixa Parcial"
										itemValue="Baixa Parcial" />
									<f:selectItem itemLabel="Cancelada" itemValue="Cancelada" />
									<p:ajax event="change"
										listener="#{baixasController.ValidaBeneficiarioUnidade()}" />

								</p:selectOneMenu>
							</div>

							<div class="col-md-4" style="width: 31%;">
								<p:outputLabel value="Competência de Baixa:" />
								<p:inputMask mask="99/9999" size="22" maxlength="100"
									id="competenciaBaixa"
									value="#{baixasController.notaFiscal.competenciaBaixa}">

								</p:inputMask>
							</div>
							
							<div class="col-sm-6"
								style="width: 14%; float: right; padding-right: 17%; padding-top: 20px;">
								<h:commandButton value="Salvar" class="btn btn-success btn-sm"
									style="  margin-left: 10px;    margin-top: 3px;"
									
									icon="ui-icon-circle-check">
									<f:ajax listener="#{baixasController.inserirNotaFiscal()}"
									execute="form" render="form :baixasForm" />

								</h:commandButton>
							</div>


						</div>	





					</h:form>
				</h:panelGroup>
			</p:dialog>
			<!-- Tela Dialog -->

			<p:ajaxStatus id="startAjax" onstart="PF('start').show();"
				oncomplete="PF('start').hide();">
			</p:ajaxStatus>
			<p:dialog widgetVar="start" modal="true" draggable="false"
				closable="false" resizable="false" showHeader="false">
				<h:graphicImage value="#{resource['img:carregandoo.gif']}"></h:graphicImage>
			</p:dialog>



		</div>

	</ui:define>
</ui:composition>
</html>
